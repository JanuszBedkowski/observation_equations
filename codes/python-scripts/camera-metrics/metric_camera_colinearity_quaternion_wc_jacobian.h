inline void observation_equation_metric_camera_colinearity_quaternion_wc(Eigen::Matrix<double, 2, 1> &delta, double ksi_0, double eta_0, double c, double px, double py, double pz, double q0, double q1, double q2, double q3, double tie_px, double tie_py, double tie_pz, double ksi_kp, double eta_kp)
{delta.coeffRef(0,0) = c*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)) - ksi_0 + ksi_kp;
delta.coeffRef(1,0) = c*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)) - eta_0 + eta_kp;
}
inline void observation_equation_metric_camera_colinearity_quaternion_wc_jacobian(Eigen::Matrix<double, 2, 10, Eigen::RowMajor> &j, double ksi_0, double eta_0, double c, double px, double py, double pz, double q0, double q1, double q2, double q3, double tie_px, double tie_py, double tie_pz, double ksi_kp, double eta_kp)
{j.coeffRef(0,0) = c*(2.0*q0*q2 + 2.0*q1*q3)*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(2*pow(q2, 2) + 2*pow(q3, 2) - 1)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(0,1) = c*(-2.0*q0*q1 + 2.0*q2*q3)*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(-2.0*q0*q3 - 2.0*q1*q2)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(0,2) = c*(2.0*q0*q2 - 2.0*q1*q3)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)) + c*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2);
j.coeffRef(0,3) = c*(2.0*q1*(-py + tie_py) - 2.0*q2*(-px + tie_px))*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(-2.0*q2*(-pz + tie_pz) + 2.0*q3*(-py + tie_py))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(0,4) = c*(2.0*q2*(-py + tie_py) + 2.0*q3*(-pz + tie_pz))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)) + c*(2.0*q0*(-py + tie_py) + 4*q1*(-pz + tie_pz) - 2.0*q3*(-px + tie_px))*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2);
j.coeffRef(0,5) = c*(-2.0*q0*(-px + tie_px) + 4*q2*(-pz + tie_pz) - 2.0*q3*(-py + tie_py))*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(-2.0*q0*(-pz + tie_pz) + 2.0*q1*(-py + tie_py) - 4*q2*(-px + tie_px))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(0,6) = c*(-2.0*q1*(-px + tie_px) - 2.0*q2*(-py + tie_py))*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(2.0*q0*(-py + tie_py) + 2.0*q1*(-pz + tie_pz) - 4*q3*(-px + tie_px))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(0,7) = c*(-2.0*q0*q2 - 2.0*q1*q3)*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(0,8) = c*(2.0*q0*q1 - 2.0*q2*q3)*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(2.0*q0*q3 + 2.0*q1*q2)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(0,9) = c*(-2.0*q0*q2 + 2.0*q1*q3)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)) + c*(2*pow(q1, 2) + 2*pow(q2, 2) - 1)*((-px + tie_px)*(-2*pow(q2, 2) - 2*pow(q3, 2) + 1) + (-py + tie_py)*(2.0*q0*q3 + 2.0*q1*q2) + (-pz + tie_pz)*(-2.0*q0*q2 + 2.0*q1*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2);
j.coeffRef(1,0) = c*(2.0*q0*q2 + 2.0*q1*q3)*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(2.0*q0*q3 - 2.0*q1*q2)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(1,1) = c*(-2.0*q0*q1 + 2.0*q2*q3)*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(2*pow(q1, 2) + 2*pow(q3, 2) - 1)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(1,2) = c*(-2.0*q0*q1 - 2.0*q2*q3)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)) + c*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2);
j.coeffRef(1,3) = c*(2.0*q1*(-py + tie_py) - 2.0*q2*(-px + tie_px))*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(2.0*q1*(-pz + tie_pz) - 2.0*q3*(-px + tie_px))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(1,4) = c*(2.0*q0*(-py + tie_py) + 4*q1*(-pz + tie_pz) - 2.0*q3*(-px + tie_px))*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(2.0*q0*(-pz + tie_pz) - 4*q1*(-py + tie_py) + 2.0*q2*(-px + tie_px))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(1,5) = c*(2.0*q1*(-px + tie_px) + 2.0*q3*(-pz + tie_pz))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)) + c*(-2.0*q0*(-px + tie_px) + 4*q2*(-pz + tie_pz) - 2.0*q3*(-py + tie_py))*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2);
j.coeffRef(1,6) = c*(-2.0*q1*(-px + tie_px) - 2.0*q2*(-py + tie_py))*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(-2.0*q0*(-px + tie_px) + 2.0*q2*(-pz + tie_pz) - 4*q3*(-py + tie_py))/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(1,7) = c*(-2.0*q0*q2 - 2.0*q1*q3)*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(-2.0*q0*q3 + 2.0*q1*q2)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(1,8) = c*(2.0*q0*q1 - 2.0*q2*q3)*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2) + c*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1));
j.coeffRef(1,9) = c*(2.0*q0*q1 + 2.0*q2*q3)/((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1)) + c*(2*pow(q1, 2) + 2*pow(q2, 2) - 1)*((-px + tie_px)*(-2.0*q0*q3 + 2.0*q1*q2) + (-py + tie_py)*(-2*pow(q1, 2) - 2*pow(q3, 2) + 1) + (-pz + tie_pz)*(2.0*q0*q1 + 2.0*q2*q3))/pow((-px + tie_px)*(2.0*q0*q2 + 2.0*q1*q3) + (-py + tie_py)*(-2.0*q0*q1 + 2.0*q2*q3) + (-pz + tie_pz)*(-2*pow(q1, 2) - 2*pow(q2, 2) + 1), 2);
}