inline void observation_equation_perspective_camera_tait_bryan_wc(Eigen::Matrix<double, 2, 1> &delta, double fx, double fy, double cx, double cy, double px, double py, double pz, double om, double fi, double ka, double tie_px, double tie_py, double tie_pz, double u_kp, double v_kp)
{delta.coeffRef(0,0) = -cx - 1.0*fx*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) + u_kp;
delta.coeffRef(1,0) = -cy - 1.0*fy*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) + v_kp;
}inline void projection_perspective_camera_tait_bryan_wc(double &u, double &v, double fx, double fy, double cx, double cy, double px, double py, double pz, double om, double fi, double ka, double tie_px, double tie_py, double tie_pz)
{u = cx + 1.0*fx*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om));
v = cy + 1.0*fy*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om));
}
inline void observation_equation_perspective_camera_tait_bryan_wc_jacobian(Eigen::Matrix<double, 2, 9> &j, double fx, double fy, double cx, double cy, double px, double py, double pz, double om, double fi, double ka, double tie_px, double tie_py, double tie_pz)
{j.coeffRef(0,0) = 1.0*fx*cos(fi)*cos(ka)/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fx*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))*sin(fi)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(0,1) = -1.0*fx*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) + 1.0*fx*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))*sin(om)*cos(fi)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(0,2) = -1.0*fx*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fx*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))*cos(fi)*cos(om)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(0,3) = -1.0*fx*(py*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)) + pz*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + tie_py*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_pz*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fx*(-py*cos(fi)*cos(om) - pz*sin(om)*cos(fi) + tie_py*cos(fi)*cos(om) + tie_pz*sin(om)*cos(fi))*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(0,4) = -1.0*fx*(px*sin(fi)*cos(ka) - py*sin(om)*cos(fi)*cos(ka) + pz*cos(fi)*cos(ka)*cos(om) - tie_px*sin(fi)*cos(ka) + tie_py*sin(om)*cos(fi)*cos(ka) - tie_pz*cos(fi)*cos(ka)*cos(om))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fx*(px*cos(fi) + py*sin(fi)*sin(om) - pz*sin(fi)*cos(om) - tie_px*cos(fi) - tie_py*sin(fi)*sin(om) + tie_pz*sin(fi)*cos(om))*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(0,5) = -1.0*fx*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om));
j.coeffRef(0,6) = -1.0*fx*cos(fi)*cos(ka)/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) + 1.0*fx*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))*sin(fi)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(0,7) = -1.0*fx*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fx*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))*sin(om)*cos(fi)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(0,8) = -1.0*fx*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) + 1.0*fx*(-px*cos(fi)*cos(ka) + py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)) + tie_px*cos(fi)*cos(ka) + tie_py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + tie_pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)))*cos(fi)*cos(om)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(1,0) = -1.0*fy*sin(ka)*cos(fi)/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fy*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))*sin(fi)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(1,1) = -1.0*fy*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) + 1.0*fy*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))*sin(om)*cos(fi)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(1,2) = -1.0*fy*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fy*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))*cos(fi)*cos(om)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(1,3) = -1.0*fy*(py*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)) + pz*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + tie_py*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) + tie_pz*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fy*(-py*cos(fi)*cos(om) - pz*sin(om)*cos(fi) + tie_py*cos(fi)*cos(om) + tie_pz*sin(om)*cos(fi))*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(1,4) = -1.0*fy*(-px*sin(fi)*sin(ka) + py*sin(ka)*sin(om)*cos(fi) - pz*sin(ka)*cos(fi)*cos(om) + tie_px*sin(fi)*sin(ka) - tie_py*sin(ka)*sin(om)*cos(fi) + tie_pz*sin(ka)*cos(fi)*cos(om))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fy*(px*cos(fi) + py*sin(fi)*sin(om) - pz*sin(fi)*cos(om) - tie_px*cos(fi) - tie_py*sin(fi)*sin(om) + tie_pz*sin(fi)*cos(om))*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(1,5) = -1.0*fy*(px*cos(fi)*cos(ka) + py*(sin(fi)*sin(om)*cos(ka) + sin(ka)*cos(om)) + pz*(-sin(fi)*cos(ka)*cos(om) + sin(ka)*sin(om)) - tie_px*cos(fi)*cos(ka) + tie_py*(-sin(fi)*sin(om)*cos(ka) - sin(ka)*cos(om)) + tie_pz*(sin(fi)*cos(ka)*cos(om) - sin(ka)*sin(om)))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om));
j.coeffRef(1,6) = 1.0*fy*sin(ka)*cos(fi)/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) + 1.0*fy*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))*sin(fi)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(1,7) = -1.0*fy*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) - 1.0*fy*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))*sin(om)*cos(fi)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
j.coeffRef(1,8) = -1.0*fy*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka))/(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om)) + 1.0*fy*(px*sin(ka)*cos(fi) + py*(sin(fi)*sin(ka)*sin(om) - cos(ka)*cos(om)) + pz*(-sin(fi)*sin(ka)*cos(om) - sin(om)*cos(ka)) - tie_px*sin(ka)*cos(fi) + tie_py*(-sin(fi)*sin(ka)*sin(om) + cos(ka)*cos(om)) + tie_pz*(sin(fi)*sin(ka)*cos(om) + sin(om)*cos(ka)))*cos(fi)*cos(om)/pow(-px*sin(fi) + py*sin(om)*cos(fi) - pz*cos(fi)*cos(om) + tie_px*sin(fi) - tie_py*sin(om)*cos(fi) + tie_pz*cos(fi)*cos(om), 2);
}